<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/screen/window.xsd"
        xmlns:app="http://schemas.company.com/demo/0.1/ui-component.xsd"
        caption="msg://extChecklistEdit.caption"
        messagesPack="com.company.quarium.web.screens.checklist">
    <data>
        <instance id="checklistDc"
                  class="com.company.quarium.entity.checklist.Checklist">
            <view extends="project-checklist-view">
                <property name="assignedQa" view="qaProjectRelationship-view"/>
                <property name="state" view="_minimal"/>
                <property name="testCase" view="testCase-edit"/>
                <property name="module" view="edit"/>
            </view>
            <loader/>
            <collection id="testCasesDc" property="testCase"/>
        </instance>
        <collection id="statesDc" class="com.company.quarium.entity.references.Statement" view="_minimal">
            <loader id="statesDl">
                <query>
                    <![CDATA[select e from quarium_Statement e]]>
                </query>
            </loader>
        </collection>
        <collection id="prioritiesDc" class="com.company.quarium.entity.references.Priority" view="_minimal">
            <loader id="prioritiesDl">
                <query>
                    <![CDATA[select e from quarium_Priority e]]>
                </query>
            </loader>
        </collection>
        <instance id="testCaseDc"
                  class="com.company.quarium.entity.checklist.TestCase">
            <view extends="testCase-view">
                <property name="priority" view="_minimal"/>
                <property name="state" view="_minimal"/>
                <property name="caseStep" view="step-view"/>
            </view>
            <loader id="testCaseDl"/>
            <collection id="stepsCollection" property="caseStep"/>
        </instance>
    </data>
    <actions>
        <action id="save" icon="icons/ok.png" caption="mainMsg://actions.Ok" shortcut="CTRL-ENTER"/>
        <action id="cancel" icon="icons/cancel.png" caption="mainMsg://actions.Cancel" description="Esc"/>
        <action id="getEstimation"/>
    </actions>
    <dialogMode height="600"
                width="800"/>
    <layout expand="editActions" spacing="true" margin="true">
        <grid spacing="true" width="100%">
            <columns>
                <column flex="4"/>
                <column flex="2"/>
                <column flex="7"/>
            </columns>
            <rows>
                <row>
                    <textField id="nameField" dataContainer="checklistDc" property="name"
                               caption="msg://checklistEdit.name"
                               width="90%" required="true"/>
                    <lookupField id="assignedQaField" dataContainer="checklistDc"
                                 property="assignedQa" caption="msg://checklistEdit.QA"
                                 width="90%"/>
                    <textArea id="commentField" dataContainer="checklistDc"
                              property="comment" caption="msg://checklistEdit.comment"
                              width="80%" rowspan="4" rows="8"/>
                </row>
                <row>
                    <lookupField id="stateField" dataContainer="checklistDc" optionsContainer="statesDc"
                                 property="state" caption="msg://checklistEdit.State"
                                 width="90%"/>
                    <lookupField id="moduleField" dataContainer="checklistDc"
                                 property="module" caption="msg://checklistEdit.module"
                                 width="90%"/>
                </row>
                <row>
                    <hbox spacing="true" caption="msg://checklistEdit.ticket" width="90%">
                        <app:linkField id="ticket" dataContainer="checklistDc" property="ticket"
                                       maxTextLength="40"/>
                    </hbox>
                    <checkBox id="isUsedInRegress" dataContainer="checklistDc" property="isUsedInRegress"
                              caption="msg://checklistEdit.isUsedInRegress"/>
                </row>
                <row>
                    <hbox caption="msg://checklistEdit.estimation" width="90%" spacing="true"
                          expand="checklistMinLabel">
                        <textField id="checklistHours" property="hours" width="50"
                                   dataContainer="checklistDc" required="true"/>
                        <label value="msg://checklistEdit.hoursLabel" align="BOTTOM_LEFT"
                               width="20"/>
                        <textField id="checklistMinutes" property="minutes" width="50"
                                   dataContainer="checklistDc" required="true"/>
                        <label id="checklistMinLabel" value="msg://checklistEdit.minutesLabel"
                               align="BOTTOM_LEFT"/>
                        <button action="getEstimation" id="button"
                                width="AUTO" caption="msg://checklistEdit.getEstimation"
                                description="Заполнить поле 'Оценка' суммой оценок тест-кейсов"
                                align="MIDDLE_RIGHT"/>
                    </hbox>
                </row>
            </rows>
        </grid>
        <groupBox id="testCaseBox" caption="msg://checklistEdit.testCaseBox">
            <split id="split" height="540" orientation="horizontal"
                   reversePosition="true" width="100%" pos="70">
                <vbox id="lookupBox" expand="table" height="100%" margin="false,true,false,false" spacing="true">
                    <table id="table"
                           width="100%"
                           dataContainer="testCasesDc"
                           multiselect="true"
                           presentations="true">
                        <actions>
                            <action id="create" type="create"/>
                            <action id="edit" type="edit"/>
                            <action id="remove" type="remove"/>
                        </actions>
                        <columns>
                            <column id="number" editable="false" width="20"/>
                            <column id="name" maxTextLength="20" expandRatio="100"/>
                        </columns>
                        <rowsCount/>
                        <buttonsPanel id="buttonsPanel"
                                      alwaysVisible="true">
                            <button id="createBtn" action="table.create"/>
                            <button id="editBtn" action="table.edit"/>
                            <button id="removeBtn" action="table.remove"/>
                        </buttonsPanel>
                    </table>
                </vbox>
                <vbox id="editBox" height="100%" margin="true,false,false,true" expand="fieldGroupBox"
                      spacing="true">
                    <scrollBox id="fieldGroupBox" width="100%">
                        <grid id="caseForm" spacing="true" width="100%">
                            <columns>
                                <column flex="2"/>
                                <column flex="1"/>
                            </columns>
                            <rows>
                                <row>
                                    <textField id="caseNameField" property="name"
                                               dataContainer="testCaseDc" caption="msg://checklistEdit.caseName"
                                               width="90%"/>
                                    <hbox caption="msg://checklistEdit.estimation" spacing="true">
                                        <textField id="caseHours" property="hours"
                                                   dataContainer="testCaseDc" width="50"/>
                                        <label id="testCaseHoursLabel"
                                               value="msg://checklistEdit.hoursLabel" align="BOTTOM_LEFT"
                                               width="20"/>
                                        <textField id="caseMinutes" property="minutes"
                                                   dataContainer="testCaseDc" width="50"/>
                                        <label id="testCaseMinLabel"
                                               value="msg://checklistEdit.minutesLabel"
                                               align="BOTTOM_LEFT"/>
                                    </hbox>
                                </row>
                                <row>
                                    <table id="stepsTable"
                                           dataContainer="stepsCollection"
                                           width="90%"
                                           responsive="true"
                                           multiselect="true"
                                           columnHeaderVisible="false"
                                           caption="msg://checklistEdit.steps"
                                           multiLineCells="true"
                                           editable="true"
                                           rowspan="3">
                                        <actions>
                                            <action id="createStep" type="create"/>
                                            <action id="removeStep" type="remove"/>
                                        </actions>
                                        <columns>
                                            <column id="number" editable="false" width="20"/>
                                            <column id="step" editable="true"/>
                                        </columns>
                                        <buttonsPanel>
                                            <button action="stepsTable.createStep" caption="" icon="ADD_ACTION"/>
                                            <button action="stepsTable.removeStep" caption="" icon="REMOVE_ACTION"/>
                                        </buttonsPanel>
                                    </table>
                                    <lookupField id="priorityField" dataContainer="testCaseDc"
                                                 optionsContainer="prioritiesDc" property="priority"
                                                 caption="msg://checklistEdit.priority" width="90%"/>
                                </row>
                                <row>
                                    <lookupField id="caseStateField" dataContainer="testCaseDc"
                                                 optionsContainer="statesDc" property="state"
                                                 caption="msg://checklistEdit.state" width="90%"/>
                                </row>
                                <row>
                                    <hbox id="ticketBox" spacing="true" caption="msg://checklistEdit.caseTicket"
                                          width="90%"
                                          visible="false">
                                        <app:linkField id="caseTicket" dataContainer="testCaseDc"
                                                       property="ticket"
                                                       maxTextLength="40"/>
                                    </hbox>
                                </row>
                                <row>
                                    <textArea id="expectedResultField" property="expectedResult"
                                              rows="4" dataContainer="testCaseDc"
                                              caption="msg://checklistEdit.expectedResult" width="90%"/>
                                    <textArea id="caseComment" dataContainer="testCaseDc"
                                              rows="4" property="comment" width="90%"
                                              caption="msg://checklistEdit.comment"
                                              visible="false"/>
                                </row>
                            </rows>
                        </grid>
                    </scrollBox>
                    <hbox id="actionsPane" spacing="true" visible="true">
                        <button id="saveBtn" action="save"/>
                        <button id="cancelBtn" action="cancel"/>
                    </hbox>
                </vbox>
            </split>
        </groupBox>
        <hbox id="editActions" spacing="true">
            <button id="commitAndCloseBtn" action="windowCommitAndClose"/>
            <button id="closeBtn" action="windowClose"/>
        </hbox>
    </layout>
</window>
