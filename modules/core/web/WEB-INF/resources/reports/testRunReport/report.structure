{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8","code":"testRunReport","roles":[],"defaultTemplate":{"metaClass":"report$ReportTemplate","id":"825680e4-644d-80bd-2a48-54ed291139a5","code":"regressReportTemplate","customDefinedBy":"100","custom":"false","version":"2","outputNamePattern":"RegressReport","reportOutputType":"50","groovy":"false","customDefinition":"","report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"name":"newTemplate.xlsx","alterable":"false"},"description":"Отчет по тестовому прогону","bands":[{"metaClass":"report$BandDefinition","id":"d29f83af-cf28-9522-ece1-d7ed834ffa94","orientation":"","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"71cce863-7382-2706-b9c2-992b073c007d","orientation":"0","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"43f78d0a-35ff-4468-d986-a1d7d07fc3f8","orientation":"0","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"6e4bc612-54c2-a659-2bf2-132f744cfb1d","orientation":"0","childrenBandDefinitions":[{"metaClass":"report$BandDefinition","id":"ee11d68f-8db4-db6a-0168-0277c22139c9","orientation":"0","childrenBandDefinitions":[],"name":"TestCase","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"6e4bc612-54c2-a659-2bf2-132f744cfb1d"},"report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"dataSets":[{"metaClass":"report$DataSet","id":"30e5eccc-510c-3b60-278f-5a646443e90a","type":"30","jsonSourceType":"10","name":"TestCase","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"ee11d68f-8db4-db6a-0168-0277c22139c9"},"text":"import com.haulmont.cuba.core.Persistence\nimport com.haulmont.cuba.core.Transaction\nimport com.haulmont.cuba.core.global.AppBeans\nimport com.company.quarium.entity.testsuit.TestCase\nimport com.company.quarium.entity.testsuit.Step\n\nPersistence persistence \u003d AppBeans.get(Persistence.NAME)\nTransaction tx \u003d persistence.createTransaction()\n\nList\u003cTestCase\u003e testCaseList \u003d parentBand.getParameterValue(\"cTestCaseList\")\n\ntry {\n    def result \u003d []\n\n    Collections.sort(testCaseList, new Comparator\u003cTestCase\u003e(){\n        public int compare(TestCase o1, TestCase o2){\n            return o1.getNumber() - o2.getNumber();\n        }\n    })\n\n    for (TestCase tc : testCaseList) {\n        String steps \u003d \"\";\n        for (Step s : tc.caseStep) {\n            if (s.step.charAt(s.step.length() - 1).toString() !\u003d \".\") {\n                steps +\u003d s.step + \". \"\n            } else {\n                steps +\u003d s.step + \" \"\n            }\n        }\n        result.add([\n                \u0027cTestCaseName\u0027  : tc.name,\n                \u0027cExpectedResult\u0027: tc.expectedResult,\n                \u0027cStep\u0027      : steps\n        ])\n    }\n    tx.commit()\n    return result\n} finally {\n    tx.end()\n}","view":"null"}],"position":"0"}],"name":"Checklist","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"43f78d0a-35ff-4468-d986-a1d7d07fc3f8"},"report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"dataSets":[{"metaClass":"report$DataSet","id":"a7a8b081-b835-fdde-ec8e-026608407fde","type":"30","jsonSourceType":"10","name":"Checklist","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"6e4bc612-54c2-a659-2bf2-132f744cfb1d"},"text":"import com.haulmont.cuba.core.Persistence\nimport com.haulmont.cuba.core.Transaction\nimport com.haulmont.cuba.core.TypedQuery\nimport com.haulmont.cuba.core.global.AppBeans\nimport com.company.quarium.entity.testsuit.RunTestSuit\n\nPersistence persistence \u003d AppBeans.get(Persistence.NAME)\nTransaction tx \u003d persistence.createTransaction()\ndef module \u003d parentBand.getParameterValue(\"cModuleId\")\n\ntry {\n    List\u003cRunTestSuit\u003e runTestSuit \u003d new ArrayList\u003c\u003e()\n    String defaultQueryString \u003d \u0027select t from quarium_RunTestSuit t where t.testRun \u003d :param\u0027\n    String resultQueryString \u003d \u0027\u0027;\n\n\n    if (module !\u003d null) {\n        resultQueryString \u003d defaultQueryString +\n                \u0027 and t.module.id \u003d :cModuleId\u0027\n    } else {\n        resultQueryString \u003d defaultQueryString +\n                \u0027 and t.module IS NULL\u0027\n    }\n\n    TypedQuery query \u003d persistence.getEntityManager().createQuery(\n            resultQueryString, RunTestSuit.class)\n            .setParameter(\u0027param\u0027, params.entity)\n            .setViewName(\u0027runTestSuit-view\u0027)\n\n    if (module !\u003d null) {\n        query.setParameter(\u0027cModuleId\u0027, module)\n    }\n\n    runTestSuit \u003d query.getResultList()\n\n\n    int n \u003d 1;\n    def result \u003d []\n    for (RunTestSuit rc : runTestSuit) {\n        String qa \u003d \"\u003cQA не назначен\u003e\"\n        if (rc.assignedQa !\u003d null) {\n            qa \u003d rc.assignedQa?.qa?.fullName\n        }\n        result.add([\n                \u0027cName\u0027        : rc.name,\n                \u0027cState\u0027       : rc.state?.name,\n                \u0027cQa\u0027          : qa,\n                \u0027cTestCaseList\u0027: rc.testCase,\n                \u0027checklist\u0027    : rc,\n                \u0027cN\u0027           : n++\n        ])\n    }\n\n    tx.commit()\n    return result\n} finally {\n    tx.end()\n}","view":"null"}],"position":"0"}],"name":"Module","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"71cce863-7382-2706-b9c2-992b073c007d"},"report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"dataSets":[{"metaClass":"report$DataSet","id":"178bfb9a-963a-ccca-eb36-656f5ce2bb0c","type":"30","jsonSourceType":"10","name":"Module","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"43f78d0a-35ff-4468-d986-a1d7d07fc3f8"},"text":"import com.haulmont.cuba.core.Persistence\nimport com.haulmont.cuba.core.Transaction\nimport com.haulmont.cuba.core.global.AppBeans\nimport com.company.quarium.entity.testsuit.RunTestSuit\n\nPersistence persistence \u003d AppBeans.get(Persistence.NAME)\nTransaction tx \u003d persistence.createTransaction()\ndef module \u003d parentBand.getParameterValue(\"cModuleId\")\n\ntry {\n    List\u003cRunTestSuit\u003e runTestSuit \u003d persistence.getEntityManager().createQuery(\n            \u0027select t from quarium_RunTestSuit t where t.testRun \u003d :param\u0027, RunTestSuit.class)\n            .setParameter(\u0027param\u0027, params.entity)\n            .setViewName(\u0027runTestSuit-view\u0027)\n            .getResultList()\n\n    def result \u003d []\n\n    for (RunTestSuit rc : runTestSuit) {\n        if (rc.getModule() !\u003d null) {\n            if (!result.contains([\n                    \u0027cModule\u0027  : rc.module?.name,\n                    \u0027cModuleId\u0027: rc.module?.id\n            ])) {\n                result.add([\n                        \u0027cModule\u0027  : rc.module?.name,\n                        \u0027cModuleId\u0027: rc.module?.id\n                ])\n            }\n        } else {\n            if (!result.contains([\n                    \u0027cModule\u0027  : \"Без модуля\",\n                    \u0027cModuleId\u0027: null])) {\n                result.add([\n                        \u0027cModule\u0027  : \"Без модуля\",\n                        \u0027cModuleId\u0027: null\n                ])\n            }\n        }\n    }\n\n    tx.commit()\n    return result\n} finally {\n    tx.end()\n}","view":"null"}],"position":"0"}],"name":"Description","parentBandDefinition":{"metaClass":"report$BandDefinition","id":"d29f83af-cf28-9522-ece1-d7ed834ffa94"},"report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"dataSets":[{"metaClass":"report$DataSet","id":"1e5aa4a7-f6bd-0751-9c8e-7b65cebd9760","type":"30","jsonSourceType":"10","name":"Description","useExistingView":"false","bandDefinition":{"metaClass":"report$BandDefinition","id":"71cce863-7382-2706-b9c2-992b073c007d"},"text":"import com.company.quarium.entity.project.ConfigurationProjectRelationship\nimport com.company.quarium.entity.project.QaProjectRelationship\nimport com.company.quarium.entity.references.Configuration\nimport com.haulmont.cuba.core.Persistence\nimport com.haulmont.cuba.core.Transaction\nimport com.haulmont.cuba.core.global.AppBeans\nimport com.company.quarium.entity.project.TestRun\n\nPersistence persistence \u003d AppBeans.get(Persistence.NAME)\nTransaction tx \u003d persistence.createTransaction()\ntry {\n    TestRun testRun \u003d persistence.getEntityManager().createQuery(\n            \u0027select t from quarium_TestRun t where t \u003d :param\u0027, TestRun.class)\n            .setParameter(\u0027param\u0027, params.entity)\n            .setViewName(\u0027testRun-view\u0027)\n            .getFirstResult()\n\n    String qaList \u003d \"\";\n    for (QaProjectRelationship q : testRun.project.qa) {\n        qaList +\u003d q.qa.fullName + \", \"\n    }\n    if (qaList.endsWith(\", \")) {\n        qaList \u003d qaList.substring(0, qaList.length() - 2)\n    }\n\n    String confList \u003d \"\";\n    for (ConfigurationProjectRelationship c : testRun.project.configuration) {\n        confList +\u003d c.configuration.configuration + \", \"\n    }\n    if (confList.endsWith(\", \")) {\n        confList \u003d confList.substring(0, confList.length() - 2)\n    }\n\n    String regressStartDate \u003d \"\"\n    if (testRun.runStartDate !\u003d null) {\n        regressStartDate \u003d String.format(\"%td.%tm.%tY\", testRun.runStartDate, testRun.runStartDate, testRun.runStartDate)\n    }\n    \n    String regressFinishDate \u003d \"\"\n    if (testRun.runFinishDate !\u003d null) {\n        regressFinishDate \u003d String.format(\"%td.%tm.%tY\", testRun.runFinishDate, testRun.runFinishDate, testRun.runFinishDate)\n    }\n\n    def result \u003d [[\n                          \u0027pName\u0027             : testRun.project.projectName,\n                          \u0027pRegressStartDate\u0027 : regressStartDate,\n                          \u0027pRegressFinishDate\u0027: regressFinishDate,\n                          \u0027pThesisVersion\u0027    : testRun.project.thesisVersion?.number,\n                          \u0027pDbms\u0027             : testRun.project.dbms?.name,\n                          \u0027pQa\u0027               : qaList,\n                          \u0027pConfiguration\u0027    : confList\n                  ]]\n    tx.commit()\n    return result\n} finally {\n    tx.end()\n}","view":"null"}],"position":"0"}],"name":"Root","report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"dataSets":[],"position":"0"},{"metaClass":"report$BandDefinition","id":"71cce863-7382-2706-b9c2-992b073c007d"},{"metaClass":"report$BandDefinition","id":"6e4bc612-54c2-a659-2bf2-132f744cfb1d"},{"metaClass":"report$BandDefinition","id":"43f78d0a-35ff-4468-d986-a1d7d07fc3f8"},{"metaClass":"report$BandDefinition","id":"ee11d68f-8db4-db6a-0168-0277c22139c9"}],"inputParameters":[{"metaClass":"report$ReportInputParameter","id":"2784d121-899b-5229-4390-ddff299ccfa7","lookup":"false","hidden":"false","entityMetaClass":"quarium_TestRun","parameterClassName":"com.company.quarium.entity.project.TestRun","predefinedTransformation":"","type":"30","required":"true","validationOn":"false","defaultDateIsCurrent":"false","report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"},"name":"Проект","alias":"entity","position":"0"}],"validationOn":"false","reportType":"10","reportScreens":[{"metaClass":"report$ReportScreen","id":"c56f47a8-c0a5-329e-f5af-8e6c3ea5803a","screenId":"quarium_TestRun.edit","report":{"metaClass":"report$Report","id":"a3884041-0dbe-d604-e9bd-729620d281a8"}}],"screensIdx":",quarium_TestRun.edit,","group":{"metaClass":"report$ReportGroup","id":"4e083530-0b9c-11e1-9b41-6bdaa41bff94","localeNames":"en\u003dGeneral\nru\u003dОбщие","code":"ReportGroup.default","title":"General","version":"0"},"inputEntityTypesIdx":",quarium_TestRun,","valuesFormats":[],"templates":[{"metaClass":"report$ReportTemplate","id":"825680e4-644d-80bd-2a48-54ed291139a5"}],"version":"24","system":"false","name":"testRunReport"}